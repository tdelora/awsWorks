#!/usr/bin/env python3
import sys
import argparse
import aws_kpc, aws_icc

parser = argparse.ArgumentParser(description='Shutdown one or more running instances')
parser.add_argument("-i","--id", help="The instance id to terminate.",type=str)
# parser.add_argument(--all", help="Terminate all running instances.")
if len(sys.argv) < 2:
    parser.print_usage()
    sys.exit(1)
args = parser.parse_args()

if args.id:
    stateCode,stateString = aws_icc.aws_instance_state(args.id)

    if stateCode == 16:
        # State 16 indicates the instance is running
        print('Instance {}: {} - Terminating'.format(args.id,stateString))
        aws_icc.aws_terminate_instance(args.id)
        stateCode,stateString = aws_icc.aws_instance_state(args.id)
        print('Instance {}: {}'.format(args.id,stateString))
    elif stateCode == 32 or stateCode == 48:
        # State 32 indicates the instance is shutting-down
        # State 48 indicates the instance is terminated
        print('Instance {}: {}'.format(args.id,stateString))
    else:
        print('Instance {}: ({}) {} - wait until state is running (16).'.format(args.id,stateCode,stateString))
